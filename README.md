# Проект "Создание 3D модели шахты с помощью БПЛА, оснащенного LiDAR"
### Целью работы является подбор высокоэффективной связки БПЛА + LiDAR + защитная клетка для съемки в шахте, а также разработка кода для полета, съемочных работ и возврата в исходную точку БПЛА с LiDAR в шахте.
### Ожидаемый продуктовый результат - получение 3D модели выработки в виде облака точек с разделением их по виду горной породы.

## Описание БПЛА, LiDAR и защитной клетки

- ### Характеристики БПЛА DJI Matrice 350 RTK

Максимальный взлетный вес - 9,2 кг

Время полета (с учетом установленного на борту LiDAR и защитной клетки) - 25-35 минут (в зависимости от нагрузки и условий)

Рабочая температура - от -20 до +50 °C

Защита от пыли и влаги - IP55

Точность позиционирования - 1 см + 1 ppm (горизонталь), 1,5 см + 1 ppm (вертикаль)

Максимальная скорость (без нагрузки) - 23 м/с

Рабочие частоты - 2,4 ГГц, 5,8 ГГц

Поддерживаемые payload-интерфейсы - DJI SkyPort, X-Port (совместим с Livox Mid-360)

- ### Характеристики LiDAR Livox Mid-360

Дальность измерения - до 260 м при 80 % отражаемости, 180-220 м при 50% отражаемости, 100-120 м при 20% отражаемости

Точность - ±2 см (на 50 м)

Частота сканирования - 100000 точек в секунду

Угол обзора - 360° (горизонталь), 59° (вертикаль)

Рабочая температура - от -10 до +40 °C

Вес - 905 грамм

Интерфейсы подключения - USB-C, CAN (Controller Area Network), 100BASE-T1

Защита от пыли и влаги - IP43

- ### Характеристики защитной клетки DJI Mavic 2 Enterprise Cage
Материал - аэрокосмический углепластик
Вес - 268 грамм
- ### Позиционные параметры установки LiDAR Livox Mid-360 относительно дрона
Xyz = "0 0 -20" (см)
Roll (крен) = 0° (LiDAR должен быть горизонтален)
Pitch (тангаж) = -5° (для увеличения обзора вниз)
Yaw (рыскание) = 0° (ось сканирования совпадает с осью дрона)
## Плюсы использования данной связки в шахте
- БПЛА DJI Matrice 350 RTK способен выдерживать большой вес. Сохраняет свою работоспособность в сложных условиях (пыль, влага). Также способен долго работать без подзарядки (25-35 минут).
- Livox Mid-360 не требует сложного монтажа. За счет своего большого угла обзора способен снимать одновременно кровлю, почву и бока выработки. Не зависит от освещения, что критически важно для работы в шахте. Также имеет высокую дальность действия.
- DJI Mavic 2 Enterprise Cage смягчит столкновение, что снижает риск поломки дрона.
# Этапы проведения съемки выработки
- ### 0. Предварительные требования
Установленное ПО: Livox Viewer (для калибровки LiDAR); ROS + LIO-SAM (для SLAM); CloudCompare (для постобработки)
- ### 1. Подготовка и инициализация (необходимо делать на поверхности)
1.1 Калибровка оборудования (Calibration_of_equipment.sh)
1.2 Настройка дрона (Setting_up_a_drone.py)
1.3 Загрузка локальной системы координат (Loading_the_local_coordinate_system.py)
- ### 2. Автономный полет
2.1 Режим свободного исследования (Free_research_mode.py)
или
2.2  Полет по маршруту (En-route_flight.py)
2.3 Контроль взлета (Take-off_check.py)
2.4 Аварийный протокол (Emergency_protocol.py)
2.5 Визуализация (мониторинг) в RViz (Visualization_in_RViz.sh)
- ### 3. Фильтрация точек в реальном времени
3.1 Фильтр в SLAM (LIO-SLAM) (Filtr.yaml)
- ### 4. Завершение миссии
4.1 Сохранение данных (Saving_data.sh)
4.2 Возврат в точку старта (Return_to_the_starting_point.py)
или
4.3 Возврат в точку старта при обнаружении тупика (Return_to_the_starting_point_when_a_deadlock_is_detected.py)
- ### 5. Постобработка
5.1 Окрас точек в зависимости от их % отражаемости (разные породы помечаются разными цветами) (Post-processing.json)
5.2 Генерация легенды (legend.py)
## Стек технологий
1. Основное ПО:  ROS Noetic (Фреймворк для SLAM и управления дроном); LIO-SLAM (SLAM-алгоритм для LiDAR+IMU); Livox SDK (Драйверы и API для Livox Mid-360); DJI Onboard SDK (Управление дроном Matrice 350); CloudCompare (Визуализация и фильтрация облаков точек).
2. Дополнительное ПО: DJI Terra (Постобработка данных LiDAR);  PDAL (Фильтрация облаков точек); QGroundControl (Планирование миссий)
3.  ROS-пакеты: ros-noetic-lio-sam (SLAM-алгоритм); ros-noetic-livox-ros-driver (Драйвер Livox :cite[2]); ros-noetic-octomap (3D-картирование); ros-noetic-rviz (Визуализация); ros-noetic-tf2 (Система координат).
4. Python-библиотеки: laspy (Чтение/запись .las/.laz :cite[4]);  open3d (3D-обработка облаков точек);  numpy as np (Матричные операции);  rospy (ROS-интерфейс);  PoseStamped (Трансляция позиции); KDTree (Кластеризация точек)
